# 体育知识智能题库平台 - 管理员功能使用指南

## 📋 管理员功能概览

系统已完整实现管理员功能，支持**多层级权限管理**：

### 🔑 角色体系

| 角色 | 权限范围 | 主要功能 |
|------|---------|----------|
| **super_admin** | 全平台 | 系统全局管理、机构管理、用户管理 |
| **admin** | 机构级别 | 机构内用户管理、数据统计、内容审核 |
| **institution_admin** | 机构管理 | 机构设置、用户管理 |
| **teacher** | 班级级别 | 班级管理、学生进度、题目管理 |
| **content_manager** | 内容管理 | 题库管理、资源审核 |

## 🚀 首次使用 - 创建超级管理员

### 1. 创建超级管理员账户

```bash
# 进入后端目录
cd backend

# 创建超级管理员
npm run create-admin

# 或者在开发环境中
npm run create-admin:dev
```

**默认超级管理员信息：**
- **用户名**: `superadmin`
- **邮箱**: `admin@sportsplatform.com`
- **密码**: `Admin123456`
- **角色**: `super_admin`

### 2. 登录管理后台

使用以下任一方式登录：

**POST** `/api/auth/login`
```json
{
  "username": "superadmin",     // 或使用邮箱: "admin@sportsplatform.com"
  "password": "Admin123456"
}
```

**响应示例：**
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "user": {
      "id": "...",
      "username": "superadmin",
      "email": "admin@sportsplatform.com",
      "role": "super_admin",
      "institution": {...}
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

## 🔧 管理员核心功能

### 1. 机构管理 (Super Admin)

#### 创建机构
**POST** `/api/institutions`
```json
{
  "name": "示例学校",
  "type": "high_school",
  "description": "示例高中",
  "contact": {
    "email": "contact@example.edu.cn",
    "phone": "021-12345678"
  },
  "settings": {
    "maxUsers": 2000,
    "enabledFeatures": ["basic", "analytics", "ai_features"]
  }
}
```

#### 机构管理功能
- ✅ 获取机构列表: `GET /api/institutions`
- ✅ 机构详情查看: `GET /api/institutions/:id`
- ✅ 更新机构信息: `PUT /api/institutions/:id`
- ✅ 删除机构: `DELETE /api/institutions/:id`
- ✅ 机构用户管理: `GET/POST /api/institutions/:id/users`
- ✅ 机构统计数据: `GET /api/institutions/:id/stats`
- ✅ 批量操作: `POST /api/institutions/batch`

### 2. 用户管理

#### 获取用户列表
**GET** `/api/users` (需要 admin/super_admin 权限)

#### 创建管理员账户
```bash
# 创建普通管理员
npm run create-admin adminuser admin@school.com Password123 "学校名称"
```

#### 用户管理功能
- ✅ 用户列表查看: `GET /api/users`
- ✅ 用户详情: `GET /api/users/:id`
- ✅ 更新用户: `PUT /api/users/:id`
- ✅ 删除用户: `DELETE /api/users/:id`
- ✅ 重置密码: `POST /api/users/:id/reset-password`
- ✅ 批量操作: `POST /api/users/batch`

### 3. 班级管理

#### 班级管理功能
- ✅ 班级列表: `GET /api/classes`
- ✅ 创建班级: `POST /api/classes`
- ✅ 班级详情: `GET /api/classes/:id`
- ✅ 学生管理: `GET/POST /api/classes/:id/students`
- ✅ 班级统计: `GET /api/classes/:id/stats`
- ✅ 学习进度: `GET /api/classes/:id/progress`

### 4. 学生进度管理

#### 进度监控功能
- ✅ 学生进度列表: `GET /api/progress/students`
- ✅ 学生详细进度: `GET /api/progress/student/:id`
- ✅ 班级整体进度: `GET /api/progress/class/:id`
- ✅ 进度分析报告: `GET /api/progress/analytics`

### 5. 成就系统管理

#### 成就管理功能
- ✅ 初始化成就: `POST /api/achievements/initialize`
- ✅ 成就列表: `GET /api/achievements`
- ✅ 成就统计: `GET /api/achievements/stats`
- ✅ 成就排行榜: `GET /api/achievements/leaderboard`

### 6. 通知系统管理

#### 通知管理功能
- ✅ 创建通知: `POST /api/notifications`
- ✅ 通知列表: `GET /api/notifications`
- ✅ 发送通知: `POST /api/notifications/:id/send`
- ✅ 通知模板: `GET/POST /api/notifications/templates`
- ✅ 通知统计: `GET /api/notifications/stats`

## 🛡️ 权限控制

### API权限示例

```typescript
// 超级管理员专用
router.delete('/institutions/:id', authenticate, authorize('super_admin'), deleteInstitution);

// 管理员及以上
router.get('/users', authenticate, authorize('admin', 'super_admin'), getUsers);

// 教师及以上
router.get('/progress/students', authenticate, authorize('teacher', 'admin', 'super_admin'), getStudentProgress);
```

### 权限级别

1. **super_admin**: 全平台最高权限
2. **admin**: 机构管理权限
3. **teacher**: 教学管理权限
4. **student**: 基础学习权限

## 📊 管理后台界面

### 主要管理功能页面

1. **机构管理页面** (`/admin/institutions`)
   - 机构列表、创建、编辑、删除
   - 机构用户管理
   - 机构统计数据

2. **用户管理页面** (`/admin/users`)
   - 用户列表、权限管理
   - 用户统计分析
   - 批量操作

3. **学生进度页面** (`/admin/progress`)
   - 学生学习进度监控
   - 班级统计分析
   - 学习数据报告

4. **成就管理页面** (`/admin/achievements`)
   - 成就系统配置
   - 成就统计和排行
   - 用户激励数据

5. **通知管理页面** (`/admin/notifications`)
   - 系统通知发送
   - 通知模板管理
   - 消息统计分析

## 🔐 安全建议

### 1. 首次登录后立即修改密码

**PUT** `/api/auth/profile`
```json
{
  "oldPassword": "Admin123456",
  "newPassword": "YourNewSecurePassword123!"
}
```

### 2. 定期更换密码
- 建议每3个月更换管理员密码
- 使用复杂密码（大小写字母+数字+特殊字符）

### 3. 权限最小化原则
- 只给必要的用户分配管理权限
- 定期审查用户权限
- 及时删除离职人员账户

## 🚨 故障排除

### 1. 创建管理员失败

```bash
# 检查数据库连接
npm run create-admin:dev

# 查看详细错误信息
```

### 2. 登录失败

- 检查用户名/邮箱是否正确
- 确认密码输入无误
- 验证账户是否被禁用 (`isActive: false`)

### 3. 权限不足

- 确认用户角色是否正确
- 检查JWT token是否有效
- 验证API端点权限要求

## 📞 技术支持

如遇问题，请检查：
1. 数据库连接状态
2. 环境变量配置
3. JWT_SECRET 设置
4. MongoDB 数据完整性

**管理员功能已完整实现，可以正常使用！** 🎉 