# 体育知识智能题库平台 - 技术栈与开发环境配置指南

## 📋 文档概述

本文档详细介绍体育知识智能题库平台的技术栈选型和完整的开发环境配置流程，为开发团队提供标准化的开发环境搭建指南。

**文档版本**: v1.0  
**更新时间**: 2024年12月  
**适用平台**: Windows / macOS / Linux

---

## 🚀 技术栈概览

### 🎯 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                   前端应用层                              │
│     React 18 + TypeScript + Ant Design + Redux         │
└─────────────────────┬───────────────────────────────────┘
                      │ HTTP/WebSocket
┌─────────────────────▼───────────────────────────────────┐
│                   后端服务层                              │
│      Node.js + Express + TypeScript + Socket.io        │
└─────────────────────┬───────────────────────────────────┘
                      │ Mongoose ODM
┌─────────────────────▼───────────────────────────────────┐
│                   数据存储层                              │
│            MongoDB + Redis(可选)                        │
└─────────────────────────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────┐
│                   AI服务层                               │
│               阿里云千问大模型API                         │
└─────────────────────────────────────────────────────────┘
```

---

## 💻 前端技术栈

### 🎨 核心框架与库

| 技术 | 版本 | 作用 | 备注 |
|------|------|------|------|
| **React** | 18.2.0 | 前端框架 | 使用函数组件 + Hooks |
| **TypeScript** | 4.9.5 | 类型系统 | 提供静态类型检查 |
| **Ant Design** | 5.6.2 | UI组件库 | 企业级UI设计语言 |
| **Redux Toolkit** | 1.9.5 | 状态管理 | Redux官方推荐工具集 |
| **React Router** | 6.13.0 | 路由管理 | SPA路由解决方案 |
| **Axios** | 1.4.0 | HTTP客户端 | API请求处理 |

### 📊 数据可视化与工具

| 技术 | 版本 | 作用 | 应用场景 |
|------|------|------|----------|
| **ECharts** | 5.4.2 | 数据可视化 | 学习进度图表、统计分析 |
| **Day.js** | 1.11.8 | 日期处理 | 轻量级日期库 |
| **Classnames** | 2.3.2 | CSS类名处理 | 条件样式应用 |
| **Redux Persist** | 6.0.0 | 状态持久化 | 用户登录状态保持 |

### 🛠️ 开发工具

| 工具 | 版本 | 作用 |
|------|------|------|
| **React Scripts** | 5.0.1 | 构建工具 |
| **Create React App** | - | 脚手架工具 |
| **HTTP Proxy Middleware** | 3.0.5 | 开发代理 |
| **Cross-env** | 10.0.0 | 跨平台环境变量 |

---

## ⚙️ 后端技术栈

### 🌐 核心框架与运行时

| 技术 | 版本 | 作用 | 备注 |
|------|------|------|------|
| **Node.js** | 18+ | JavaScript运行时 | LTS版本 |
| **Express** | 4.18.2 | Web框架 | 轻量级Web服务框架 |
| **TypeScript** | 5.0.2 | 类型系统 | 后端静态类型检查 |
| **Socket.io** | 4.8.1 | WebSocket通信 | 实时通信支持 |

### 🗄️ 数据库与ORM

| 技术 | 版本 | 作用 | 特点 |
|------|------|------|------|
| **MongoDB** | 6.0+ | NoSQL数据库 | 文档型数据库 |
| **Mongoose** | 7.0.0 | MongoDB ODM | 对象文档映射 |
| **Redis** | 7+ | 缓存数据库 | 可选，用于缓存和会话 |

### 🔒 安全与认证

| 技术 | 版本 | 作用 |
|------|------|------|
| **JWT** | 9.0.2 | 身份认证 |
| **BCrypt** | 2.4.3 | 密码加密 |
| **Helmet** | 6.0.1 | 安全中间件 |
| **CORS** | 2.8.5 | 跨域处理 |
| **Express Rate Limit** | 6.7.0 | 请求限流 |

### 📁 文件处理与通信

| 技术 | 版本 | 作用 |
|------|------|------|
| **Multer** | 1.4.5 | 文件上传 |
| **Nodemailer** | 6.10.1 | 邮件服务 |
| **Handlebars** | 4.7.8 | 模板引擎 |
| **XLSX** | 0.18.5 | Excel文件处理 |

### 🧪 开发与测试工具

| 工具 | 版本 | 作用 |
|------|------|------|
| **ts-node** | 10.9.1 | TypeScript直接运行 |
| **Nodemon** | 2.0.20 | 自动重启服务 |
| **Jest** | 29.5.0 | 测试框架 |
| **Joi** | 17.8.3 | 数据验证 |

---

## 🤖 AI与外部服务

### 🧠 人工智能服务

| 服务 | 提供商 | 作用 | 模型 |
|------|-------|------|------|
| **千问大模型** | 阿里云 | 智能题目生成 | qwen3-235b-a22b-instruct-2507 |
| **DashScope API** | 阿里云 | AI服务接口 | 兼容OpenAI格式 |

### 📧 第三方服务

| 服务类型 | 用途 | 备注 |
|----------|------|------|
| **邮件服务** | 用户通知、密码重置 | 支持Gmail等SMTP服务 |
| **短信服务** | 手机验证码 | 可选配置 |

---

## 🐳 容器化与部署

### 🚢 容器技术

| 技术 | 版本 | 作用 |
|------|------|------|
| **Docker** | 最新 | 容器化部署 |
| **Docker Compose** | 3.8 | 多容器编排 |
| **Nginx** | Alpine | 反向代理 |

### 🔧 进程管理

| 工具 | 用途 | 环境 |
|------|------|------|
| **PM2** | 生产环境进程管理 | Linux服务器 |
| **Concurrently** | 开发环境并发运行 | 本地开发 |

---

## 🛠️ 开发环境配置

### 📋 系统要求

**最低要求**：
- **操作系统**: Windows 10+ / macOS 10.15+ / Ubuntu 18.04+
- **内存**: 8GB RAM
- **存储**: 10GB 可用空间
- **网络**: 稳定的互联网连接

**推荐配置**：
- **操作系统**: Windows 11 / macOS 12+ / Ubuntu 20.04+
- **内存**: 16GB RAM
- **存储**: 20GB+ SSD
- **处理器**: 4核心以上

### 🔧 第一步：基础环境安装

#### 1.1 安装Node.js

**Windows / macOS**:
```bash
# 访问官网下载安装包
# https://nodejs.org/
# 选择LTS版本 (18.x)

# 验证安装
node --version  # 应显示 v18.x.x
npm --version   # 应显示 9.x.x
```

**Ubuntu**:
```bash
# 使用NodeSource repository
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 验证安装
node --version
npm --version
```

#### 1.2 安装包管理器(可选)

```bash
# 安装Yarn (可选，推荐)
npm install -g yarn

# 安装pnpm (可选，更快的包管理器)
npm install -g pnpm
```

#### 1.3 安装Git

**Windows**: 下载Git for Windows  
**macOS**: `brew install git` 或 Xcode Command Line Tools  
**Ubuntu**: `sudo apt install git`

### 🗄️ 第二步：数据库安装

#### 2.1 安装MongoDB

**Windows**:
```bash
# 下载MongoDB Community Server
# https://www.mongodb.com/try/download/community
# 选择MSI安装包，默认配置安装
```

**macOS**:
```bash
# 使用Homebrew
brew tap mongodb/brew
brew install mongodb-community@6.0

# 启动服务
brew services start mongodb/brew/mongodb-community
```

**Ubuntu**:
```bash
# 导入GPG密钥
wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -

# 添加repository
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list

# 安装MongoDB
sudo apt-get update
sudo apt-get install -y mongodb-org

# 启动服务
sudo systemctl start mongod
sudo systemctl enable mongod
```

#### 2.2 安装Redis (可选)

**Windows**:
```bash
# 下载Redis for Windows
# https://github.com/tporadowski/redis/releases
```

**macOS**:
```bash
brew install redis
brew services start redis
```

**Ubuntu**:
```bash
sudo apt install redis-server
sudo systemctl start redis-server
sudo systemctl enable redis-server
```

### 📁 第三步：项目克隆与安装

#### 3.1 克隆项目

```bash
# 克隆项目仓库
git clone https://github.com/your-repo/sports-knowledge-platform.git
cd sports-knowledge-platform

# 或者从现有代码解压
# 解压项目文件到本地目录
```

#### 3.2 安装项目依赖

```bash
# 方法1：使用根目录脚本 (推荐)
npm run install:all

# 方法2：分别安装
# 安装根目录依赖
npm install

# 安装后端依赖
cd backend
npm install

# 安装前端依赖
cd ../frontend
npm install
```

### ⚙️ 第四步：环境配置

#### 4.1 后端环境配置

```bash
# 进入后端目录
cd backend

# 复制环境变量配置文件
cp config.example.env .env

# 编辑环境变量
# Windows: notepad .env
# macOS/Linux: vim .env 或 nano .env
```

**后端环境变量 (.env)**:
```bash
# 数据库配置
MONGODB_URI=mongodb://localhost:27017/sports_knowledge_platform

# JWT密钥 (请修改为复杂的随机字符串)
JWT_SECRET=your_super_secure_jwt_secret_key_minimum_32_characters
JWT_EXPIRE=7d

# 服务器配置
PORT=5000
NODE_ENV=development

# 阿里云千问模型API配置 (需要申请API Key)
DASHSCOPE_API_KEY=your_dashscope_api_key_here
DASHSCOPE_API_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
DASHSCOPE_MODEL=qwen3-235b-a22b-instruct-2507

# 邮件服务配置 (可选)
EMAIL_SERVICE=gmail
EMAIL_USER=your_email@gmail.com
EMAIL_PASS=your_email_app_password

# 文件上传配置
UPLOAD_DIR=uploads
MAX_FILE_SIZE=10485760

# Redis配置 (可选)
REDIS_URL=redis://localhost:6379
```

#### 4.2 前端环境配置

```bash
# 进入前端目录
cd frontend

# 创建环境变量文件 (可选)
echo "REACT_APP_API_URL=http://localhost:5000/api" > .env.development.local
```

**前端环境变量 (.env.development.local)**:
```bash
# API地址
REACT_APP_API_URL=http://localhost:5000/api

# 上传文件地址
REACT_APP_UPLOAD_URL=http://localhost:5000/uploads

# 开发环境配置
DANGEROUSLY_DISABLE_HOST_CHECK=true
```

### 🗃️ 第五步：数据库初始化

#### 5.1 创建数据库用户 (可选，用于生产环境)

```bash
# 连接MongoDB
mongosh

# 切换到admin数据库
use admin

# 创建应用数据库用户
use sports_knowledge_platform
db.createUser({
  user: "sportapp",
  pwd: "your_database_password",
  roles: [ { role: "readWrite", db: "sports_knowledge_platform" } ]
})

exit
```

#### 5.2 初始化测试数据

```bash
# 在后端目录执行
cd backend

# 创建默认管理员账户
npm run create-admin:dev

# 初始化测试数据 (可选)
npm run init-test-data

# 初始化学校机构数据 (可选)
npm run init-institutions
```

### 🚀 第六步：启动开发服务

#### 6.1 方法1：并发启动 (推荐)

```bash
# 在项目根目录执行
npm run dev

# 这将同时启动：
# - 后端API服务 (http://localhost:5000)
# - 前端开发服务 (http://localhost:3000)
```

#### 6.2 方法2：分别启动

**启动后端服务**:
```bash
cd backend
npm run dev

# 服务启动在 http://localhost:5000
# API健康检查: http://localhost:5000/api/health
```

**启动前端服务**:
```bash
cd frontend
npm start

# 服务启动在 http://localhost:3000
# 自动打开浏览器访问应用
```

### 🧪 第七步：开发工具配置

#### 7.1 VS Code配置 (推荐)

**安装推荐扩展**:
```json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-eslint",
    "ms-vscode.vscode-json",
    "mongodb.mongodb-vscode",
    "ms-vscode.vscode-thunder-client"
  ]
}
```

**工作区配置 (.vscode/settings.json)**:
```json
{
  "typescript.preferences.includePackageJsonAutoImports": "auto",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "files.associations": {
    "*.env*": "dotenv"
  },
  "emmet.includeLanguages": {
    "typescript": "html",
    "typescriptreact": "html"
  }
}
```

#### 7.2 调试配置

**VS Code调试配置 (.vscode/launch.json)**:
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Backend",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/backend/src/index.ts",
      "outFiles": ["${workspaceFolder}/backend/dist/**/*.js"],
      "runtimeArgs": ["-r", "ts-node/register"],
      "env": {
        "NODE_ENV": "development"
      },
      "cwd": "${workspaceFolder}/backend"
    },
    {
      "name": "Debug Frontend",
      "type": "node",
      "request": "launch",
      "cwd": "${workspaceFolder}/frontend",
      "runtimeExecutable": "npm",
      "runtimeArgs": ["start"]
    }
  ]
}
```

---

## 📝 开发命令参考

### 🎯 根目录命令

```bash
# 并发启动前后端开发服务
npm run dev

# 安装所有依赖
npm run install:all

# 构建整个项目
npm run build

# 启动生产环境 (前端开发模式 + 后端生产模式)
npm start
```

### ⚙️ 后端命令

```bash
cd backend

# 开发模式 (热重载)
npm run dev

# 生产模式启动
npm start

# 构建TypeScript
npm run build

# 运行测试
npm test

# 数据库管理
npm run create-admin:dev      # 创建管理员
npm run init-test-data        # 初始化测试数据
npm run init-institutions     # 初始化机构数据
npm run create-schools        # 创建学校账户
```

### 🎨 前端命令

```bash
cd frontend

# 开发模式启动
npm start

# 生产构建
npm run build

# 运行测试
npm test

# 弹出Create React App配置 (不推荐)
npm run eject
```

---

## 🐞 调试与测试

### 🔍 后端API测试

#### 使用Thunder Client (VS Code扩展)

**健康检查**:
```http
GET http://localhost:5000/api/health
```

**用户注册**:
```http
POST http://localhost:5000/api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123",
  "role": "student"
}
```

**用户登录**:
```http
POST http://localhost:5000/api/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "password123"
}
```

#### 使用curl命令

```bash
# 健康检查
curl http://localhost:5000/api/health

# 获取用户信息 (需要JWT token)
curl -H "Authorization: Bearer your_jwt_token" \
     http://localhost:5000/api/auth/profile
```

### 🧪 前端测试

```bash
cd frontend

# 运行所有测试
npm test

# 运行测试并生成覆盖率报告
npm test -- --coverage

# 运行特定测试文件
npm test -- --testPathPattern=Login.test.tsx
```

### 📊 性能监控

#### 后端性能监控

```bash
# 安装性能监控工具
npm install -g clinic

# 性能分析
clinic doctor -- node dist/index.js

# 内存泄漏检测
clinic bubbleprof -- node dist/index.js
```

#### 前端性能监控

```javascript
// src/reportWebVitals.ts 已配置
// 在浏览器开发者工具中查看Performance面板
```

---

## 🚀 项目结构说明

### 📁 项目目录结构

```
sports-knowledge-platform/
├── 📁 backend/                    # 后端源码
│   ├── 📁 src/
│   │   ├── 📁 config/             # 配置文件
│   │   ├── 📁 controllers/        # 控制器
│   │   ├── 📁 middleware/         # 中间件
│   │   ├── 📁 models/            # 数据模型
│   │   ├── 📁 routes/            # 路由定义
│   │   ├── 📁 services/          # 业务逻辑
│   │   ├── 📁 scripts/           # 脚本工具
│   │   ├── 📁 types/             # 类型定义
│   │   └── 📄 index.ts           # 入口文件
│   ├── 📄 package.json
│   ├── 📄 tsconfig.json
│   └── 📄 .env                   # 环境变量
├── 📁 frontend/                   # 前端源码
│   ├── 📁 src/
│   │   ├── 📁 components/         # 组件
│   │   ├── 📁 pages/             # 页面
│   │   ├── 📁 services/          # API服务
│   │   ├── 📁 store/             # Redux状态管理
│   │   ├── 📁 types/             # 类型定义
│   │   ├── 📁 styles/            # 样式文件
│   │   └── 📄 index.tsx          # 入口文件
│   ├── 📁 public/                # 静态资源
│   ├── 📄 package.json
│   └── 📄 tsconfig.json
├── 📁 data/                      # 数据文件
├── 📁 docs/                      # 文档
├── 📄 docker-compose.yml         # Docker编排
├── 📄 package.json               # 根包配置
└── 📄 README.md                  # 项目说明
```

### 🎯 架构特点

#### 前端架构特点
- **组件化开发**: 使用React函数组件 + Hooks
- **类型安全**: 全TypeScript开发
- **状态管理**: Redux Toolkit集中状态管理
- **路由管理**: React Router 6声明式路由
- **UI一致性**: Ant Design统一设计规范

#### 后端架构特点
- **RESTful API**: 标准REST API设计
- **中间件模式**: Express中间件架构
- **数据模型**: Mongoose ODM对象映射
- **安全防护**: 多层安全中间件
- **模块化设计**: MVC架构分层设计

---

## 🔧 常见问题与解决方案

### ❓ 环境问题

#### 1. Node.js版本不兼容

**问题**: `npm install` 失败，提示Node.js版本不支持

**解决方案**:
```bash
# 检查Node.js版本
node --version

# 如果版本低于18，请升级Node.js
# 使用nvm管理Node.js版本 (推荐)
nvm install 18
nvm use 18
```

#### 2. 端口被占用

**问题**: 启动服务时提示端口已被占用

**解决方案**:
```bash
# Windows: 查找占用端口的进程
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# macOS/Linux: 查找并杀死进程
lsof -ti:5000 | xargs kill -9

# 或者修改端口配置
# backend/.env: PORT=5001
# frontend/src/setupProxy.js: target: 'http://localhost:5001'
```

#### 3. MongoDB连接失败

**问题**: 后端启动时提示数据库连接失败

**解决方案**:
```bash
# 检查MongoDB服务状态
# Windows: 服务管理器中检查MongoDB服务
# macOS: brew services list | grep mongodb
# Linux: sudo systemctl status mongod

# 启动MongoDB服务
# Windows: net start MongoDB
# macOS: brew services start mongodb-community
# Linux: sudo systemctl start mongod

# 检查连接字符串
# backend/.env 中的 MONGODB_URI 是否正确
```

### ❓ 开发问题

#### 1. 前端代理失败

**问题**: 前端无法访问后端API，出现CORS错误

**解决方案**:
```javascript
// 检查 frontend/src/setupProxy.js 配置
// 确保target地址正确
target: 'http://localhost:5000'

// 确保后端服务已启动
// 访问 http://localhost:5000/api/health 测试
```

#### 2. TypeScript编译错误

**问题**: TypeScript类型检查失败

**解决方案**:
```bash
# 清除TypeScript缓存
# 删除 node_modules 和 lock files
rm -rf node_modules package-lock.json
npm install

# 检查tsconfig.json配置
# 确保include/exclude路径正确
```

#### 3. 环境变量未生效

**问题**: 配置的环境变量没有加载

**解决方案**:
```bash
# 确保.env文件位置正确
# backend/.env (后端)
# frontend/.env.development.local (前端)

# 重启开发服务
# 环境变量修改后需要重启服务才能生效
```

### ❓ 部署问题

#### 1. 生产构建失败

**问题**: `npm run build` 失败

**解决方案**:
```bash
# 清除缓存重新构建
npm run clean  # 如果有clean脚本
rm -rf dist build
npm run build

# 检查内存是否足够
# 增加Node.js内存限制
export NODE_OPTIONS="--max-old-space-size=4096"
npm run build
```

#### 2. Docker构建问题

**问题**: Docker镜像构建失败或运行异常

**解决方案**:
```bash
# 重新构建镜像
docker-compose down
docker-compose build --no-cache
docker-compose up

# 检查容器日志
docker-compose logs backend
docker-compose logs frontend
```

---

## 📚 学习资源与文档

### 📖 官方文档

#### 前端技术文档
- [React官方文档](https://react.dev/)
- [TypeScript官方文档](https://www.typescriptlang.org/docs/)
- [Ant Design官方文档](https://ant.design/docs/react/introduce-cn)
- [Redux Toolkit官方文档](https://redux-toolkit.js.org/)
- [React Router官方文档](https://reactrouter.com/)

#### 后端技术文档
- [Node.js官方文档](https://nodejs.org/docs/)
- [Express官方文档](https://expressjs.com/)
- [MongoDB官方文档](https://docs.mongodb.com/)
- [Mongoose官方文档](https://mongoosejs.com/docs/guide.html)
- [Socket.io官方文档](https://socket.io/docs/v4/)

### 🎓 推荐学习路径

#### 新手开发者
1. **JavaScript基础** → **TypeScript基础**
2. **React基础** → **React Hooks** → **React Router**
3. **Node.js基础** → **Express框架**
4. **MongoDB基础** → **Mongoose ODM**
5. **项目实践** → **部署上线**

#### 进阶开发者
1. **Redux状态管理** → **中间件机制**
2. **RESTful API设计** → **GraphQL**
3. **数据库优化** → **缓存策略**
4. **性能优化** → **监控告警**
5. **微服务架构** → **容器化部署**

### 🔗 社区资源

- **GitHub仓库**: 项目源码和Issue讨论
- **Stack Overflow**: 技术问题求助
- **掘金/CSDN**: 中文技术文章
- **Medium**: 英文技术博客
- **Discord/QQ群**: 开发者社区交流

---

## 🎯 总结

### ✅ 核心优势

1. **现代化技术栈**: 采用React 18 + Node.js 18最新稳定版本
2. **类型安全**: 前后端全TypeScript开发，提供完整类型检查
3. **开发体验**: 热重载、自动代理、一键启动等便捷功能
4. **生产就绪**: 完善的安全防护、性能优化和部署方案
5. **AI集成**: 深度集成阿里云千问大模型，支持智能题目生成

### 🚀 开发效率

- **快速上手**: 详细的配置指南和开发文档
- **标准化**: 统一的代码规范和项目结构
- **工具链**: 完整的开发、测试、构建、部署工具链
- **调试友好**: 完善的错误处理和调试配置

### 📈 扩展性

- **模块化设计**: 前后端分离，组件化开发
- **API标准**: RESTful API设计，易于对接
- **数据库**: MongoDB文档数据库，灵活的数据结构
- **容器化**: Docker支持，便于部署和扩展

按照本指南配置开发环境，您将获得一个完整、高效、现代化的开发体验。建议开发团队严格按照本文档进行环境配置，确保开发环境的一致性和稳定性。